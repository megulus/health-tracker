(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},n=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};!function(t){return"function"==typeof define&&define.amd?define(["underscore","backbone","exports"],t):"object"==typeof exports?t(require("underscore"),require("backbone"),exports):t(_,Backbone,{})}(function(e,s,o){return o=function(o){function r(){this.triggerCancel=t(this.triggerCancel,this),this.triggerSubmit=t(this.triggerSubmit,this),this.triggerView=t(this.triggerView,this),this.clickOutsideElement=t(this.clickOutsideElement,this),this.clickOutside=t(this.clickOutside,this),this.checkKey=t(this.checkKey,this),this.rendererCompleted=t(this.rendererCompleted,this),this.args=Array.prototype.slice.apply(arguments),s.View.prototype.constructor.apply(this,this.args),this.setUIElements()}return i(r,o),r.prototype.prefix="bbm",r.prototype.animate=!0,r.prototype.keyControl=!0,r.prototype.showViewOnRender=!0,r.prototype.render=function(t){var i,n;return i=this.serializeData(),t&&!e.isEmpty(t)||(t=0),this.$el.addClass(""+this.prefix+"-wrapper"),this.modalEl=s.$("<div />").addClass(""+this.prefix+"-modal"),this.template&&this.modalEl.html(this.buildTemplate(this.template,i)),this.$el.html(this.modalEl),this.viewContainer?(this.viewContainerEl=this.modalEl.find(this.viewContainer),this.viewContainerEl.addClass(""+this.prefix+"-modal__views")):this.viewContainerEl=this.modalEl,s.$(":focus").blur(),(null!=(n=this.views)?n.length:void 0)>0&&this.showViewOnRender&&this.openAt(t),"function"==typeof this.onRender&&this.onRender(),this.delegateModalEvents(),this.$el.fadeIn&&this.animate?(this.modalEl.css({opacity:0}),this.$el.fadeIn({duration:100,complete:this.rendererCompleted})):this.rendererCompleted(),this},r.prototype.rendererCompleted=function(){var t;return this.keyControl&&(s.$("body").on("keyup.bbm",this.checkKey),this.$el.on("mouseup.bbm",this.clickOutsideElement),this.$el.on("click.bbm",this.clickOutside)),this.modalEl.css({opacity:1}).addClass(""+this.prefix+"-modal--open"),"function"==typeof this.onShow&&this.onShow(),null!=(t=this.currentView)&&"function"==typeof t.onShow?t.onShow():void 0},r.prototype.setUIElements=function(){var t;if(this.template=this.getOption("template"),this.views=this.getOption("views"),null!=(t=this.views)&&(t.length=e.size(this.views)),this.viewContainer=this.getOption("viewContainer"),this.animate=this.getOption("animate"),e.isUndefined(this.template)&&e.isUndefined(this.views))throw new Error("No template or views defined for Backbone.Modal");if(this.template&&this.views&&e.isUndefined(this.viewContainer))throw new Error("No viewContainer defined for Backbone.Modal")},r.prototype.getOption=function(t){return t?this.options&&n.call(this.options,t)>=0&&null!=this.options[t]?this.options[t]:this[t]:void 0},r.prototype.serializeData=function(){var t;return t={},this.model&&(t=e.extend(t,this.model.toJSON())),this.collection&&(t=e.extend(t,{items:this.collection.toJSON()})),t},r.prototype.delegateModalEvents=function(){var t,i,n,s,o,r,h;this.active=!0,t=this.getOption("cancelEl"),o=this.getOption("submitEl"),o&&this.$el.on("click",o,this.triggerSubmit),t&&this.$el.on("click",t,this.triggerCancel),h=[];for(i in this.views)e.isString(i)&&"length"!==i?(n=i.match(/^(\S+)\s*(.*)$/),r=n[1],s=n[2],h.push(this.$el.on(r,s,this.views[i],this.triggerView))):h.push(void 0);return h},r.prototype.undelegateModalEvents=function(){var t,i,n,s,o,r,h;this.active=!1,t=this.getOption("cancelEl"),o=this.getOption("submitEl"),o&&this.$el.off("click",o,this.triggerSubmit),t&&this.$el.off("click",t,this.triggerCancel),h=[];for(i in this.views)e.isString(i)&&"length"!==i?(n=i.match(/^(\S+)\s*(.*)$/),r=n[1],s=n[2],h.push(this.$el.off(r,s,this.views[i],this.triggerView))):h.push(void 0);return h},r.prototype.checkKey=function(t){if(this.active)switch(t.keyCode){case 27:return this.triggerCancel(t);case 13:return this.triggerSubmit(t)}},r.prototype.clickOutside=function(t){var e;return(null!=(e=this.outsideElement)?e.hasClass(""+this.prefix+"-wrapper"):void 0)&&this.active?this.triggerCancel():void 0},r.prototype.clickOutsideElement=function(t){return this.outsideElement=s.$(t.target)},r.prototype.buildTemplate=function(t,i){var n;return(n="function"==typeof t?t:e.template(s.$(t).html()))(i)},r.prototype.buildView=function(t,i){var n;if(t)return i&&e.isFunction(i)&&(i=i()),e.isFunction(t)?(n=new t(i||this.args[0]),n instanceof s.View?{el:n.render().$el,view:n}:{el:t(i||this.args[0])}):{view:t,el:t.$el}},r.prototype.triggerView=function(t){var i,n,s,o,r,h,l;if(null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),o=t.data,n=this.buildView(o.view,o.viewOptions),this.currentView&&(this.previousView=this.currentView,!(null!=(l=o.openOptions)?l.skipSubmit:void 0))){if(("function"==typeof(r=this.previousView).beforeSubmit?r.beforeSubmit(t):void 0)===!1)return;"function"==typeof(h=this.previousView).submit&&h.submit()}this.currentView=n.view||n.el,i=0;for(s in this.views)o.view===this.views[s].view&&(this.currentIndex=i),i++;return o.onActive&&(e.isFunction(o.onActive)?o.onActive(this):e.isString(o.onActive)&&this[o.onActive].call(this,o)),this.shouldAnimate?this.animateToView(n.el):(this.shouldAnimate=!0,this.$(this.viewContainerEl).html(n.el))},r.prototype.animateToView=function(t){var e,i,n,o,r,h,l;return o={position:"relative",top:-9999,left:-9999},r=s.$("<tester/>").css(o),r.html(this.$el.clone().css(o)),0!==s.$("tester").length?s.$("tester").replaceWith(r):s.$("body").append(r),e=this.viewContainer?r.find(this.viewContainer):r.find("."+this.prefix+"-modal"),e.removeAttr("style"),n=e.outerHeight(),e.html(t),i=e.outerHeight(),n===i?(this.$(this.viewContainerEl).html(t),"function"==typeof(h=this.currentView).onShow&&h.onShow(),null!=(l=this.previousView)&&"function"==typeof l.destroy?l.destroy():void 0):this.animate?(this.$(this.viewContainerEl).css({opacity:0}),this.$(this.viewContainerEl).animate({height:i},100,function(e){return function(){var i,n;return e.$(e.viewContainerEl).css({opacity:1}).removeAttr("style"),e.$(e.viewContainerEl).html(t),"function"==typeof(i=e.currentView).onShow&&i.onShow(),null!=(n=e.previousView)&&"function"==typeof n.destroy?n.destroy():void 0}}(this))):this.$(this.viewContainerEl).css({height:i}).html(t)},r.prototype.triggerSubmit=function(t){var e,i;return null!=t&&t.preventDefault(),s.$(t.target).is("textarea")||this.beforeSubmit&&this.beforeSubmit(t)===!1||this.currentView&&this.currentView.beforeSubmit&&this.currentView.beforeSubmit(t)===!1?void 0:this.submit||(null!=(e=this.currentView)?e.submit:void 0)||this.getOption("submitEl")?(null!=(i=this.currentView)&&"function"==typeof i.submit&&i.submit(),"function"==typeof this.submit&&this.submit(),this.regionEnabled?this.trigger("modal:destroy"):this.destroy()):this.triggerCancel()},r.prototype.triggerCancel=function(t){return null!=t&&t.preventDefault(),this.beforeCancel&&this.beforeCancel()===!1?void 0:("function"==typeof this.cancel&&this.cancel(),this.regionEnabled?this.trigger("modal:destroy"):this.destroy())},r.prototype.destroy=function(){var t;return s.$("body").off("keyup.bbm",this.checkKey),this.$el.off("mouseup.bbm",this.clickOutsideElement),this.$el.off("click.bbm",this.clickOutside),s.$("tester").remove(),"function"==typeof this.onDestroy&&this.onDestroy(),this.shouldAnimate=!1,this.modalEl.addClass(""+this.prefix+"-modal--destroy"),t=function(t){return function(){var e;return null!=(e=t.currentView)&&"function"==typeof e.remove&&e.remove(),t.remove()}}(this),this.$el.fadeOut&&this.animate?(this.$el.fadeOut({duration:200}),e.delay(function(){return t()},200)):t()},r.prototype.openAt=function(t){var i,n,s,o,r;e.isNumber(t)?i=t:e.isNumber(t._index)&&(i=t._index),s=0;for(o in this.views)if("length"!==o)if(e.isNumber(i))s===i&&(r=this.views[o]),s++;else if(e.isObject(t))for(n in this.views[o])t[n]===this.views[o][n]&&(r=this.views[o]);return r&&(this.currentIndex=e.indexOf(this.views,r),this.triggerView({data:e.extend(r,{openOptions:t})})),this},r.prototype.next=function(t){return null==t&&(t={}),this.currentIndex+1<this.views.length?this.openAt(e.extend(t,{_index:this.currentIndex+1})):void 0},r.prototype.previous=function(t){return null==t&&(t={}),this.currentIndex-1<this.views.length-1?this.openAt(e.extend(t,{_index:this.currentIndex-1})):void 0},r}(s.View),s.Modal=o,s.Modal})}).call(this);
var app=app||{};app.SearchItem=Backbone.Model.extend({defaults:{brand:"Not specified",item:"Not specified",calories:0,date:Date.now()}});
var app=app||{},SearchCollection=Backbone.Collection.extend({model:app.SearchItem});app.SearchCollection=new SearchCollection;
$(function(){var e=Backbone.Modal.extend({template:"#modal-template",cancelEl:"#cancel-btn",submitEl:"#clear-btn",events:{"click #clear-btn":"clearUserCollection"},clearUserCollection:function(){_.each(_.clone(app.UserCollection.models),function(e){e.destroy()})}});$(".open").on("click",function(){var l=new e;$(".modal-div").html(l.render().el)})});
var app=app||{},ProgressModal=Backbone.Modal.extend({template:"#progress-modal"});app.ProgressModal=new ProgressModal;
var app=app||{};app.FoodItem=Backbone.Model.extend({defaults:{brand:"",item:"",calories:0,date:Date.now()}});
var app=app||{},UserCollection=Backbone.Firebase.Collection.extend({url:"https://popping-fire-4784.firebaseIO.com",model:app.FoodItem,autoSync:!0,byYear:function(){var t=this.filter(function(t){return new Date(t.get("date")).getFullYear()===todayYear});return t},byMonth:function(){var t=this.byYear().filter(function(t){return new Date(t.get("date")).getMonth()===todayMonth});return t},byWeek:function(){var t=this.byMonth().filter(function(t){return new Date(t.get("date"))>=todayMinusSeven&&new Date(t.get("date"))<=today});return t},today:function(){var t=this.byWeek().filter(function(t){return new Date(t.get("date")).getDate()===todayDate});return t},totalCalories:function(){var t,e=0;return t="year"===app.FoodItemFilter?this.byYear():"day"===app.FoodItemFilter?this.today():"month"===app.FoodItemFilter?this.byMonth():"week"===app.FoodItemFilter?this.byWeek():this,t.forEach(function(t){e+=Math.round(t.get("calories"))}),e},nextOrder:function(){return this.length?this.last().get("order")+1:1}});app.UserCollection=new UserCollection;
var app=app||{};app.SearchItemView=Backbone.View.extend({template:_.template($("#search-item-template").html()),events:{"click .add":"addNewTrackedItem"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},addNewTrackedItem:function(){app.UserCollection.add({brand:this.model.get("brand"),item:this.model.get("item"),calories:this.model.get("calories"),date:this.model.get("date"),order:app.UserCollection.nextOrder()})}});
var app=app||{};app.FoodItemView=Backbone.View.extend({template:_.template($("#food-item-template").html()),events:{"click .delete":"removeItem"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"visible",this.toggleVisible)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.toggleVisible(),this},toggleVisible:function(){this.$el.toggleClass("hide",this.isHidden())},isHidden:function(){var e=new Date(this.model.get("date")),t=e.getDate(),i=e.getMonth(),o=e.getFullYear(),l=e>=todayMinusSeven&&e<=today;return o!==todayYear&&"year"===app.FoodItemFilter||i!==todayMonth&&"month"===app.FoodItemFilter||t!==todayDate&&"day"===app.FoodItemFilter||!l&&"week"===app.FoodItemFilter},removeItem:function(){this.model.destroy()}});
var app=app||{};app.AppView=Backbone.View.extend({el:$("#healthapp"),events:{"click #search-button":"search"},initialize:function(){this.$input=this.$("#search"),this.$results=this.$("#search-results"),this.$counter=this.$(".calories"),this.$resultstxt=this.$("#results-txt"),this.$clearTracker=this.$("#clear-tracker"),this.$tracker=this.$("#foods-tracked"),this.toggleClearLink(),this.listenTo(app.SearchCollection,"add",this.addSearchItem),this.listenTo(app.SearchCollection,"reset",this.clear),this.listenTo(app.UserCollection,"add",this.toggleClearLink),this.listenTo(app.UserCollection,"add",this.addFoodItem),this.listenTo(app.UserCollection,"add",this.displayCalories),this.listenTo(app.UserCollection,"remove",this.toggleClearLink),this.listenTo(app.UserCollection,"remove",this.removeFoodItem),this.listenTo(app.UserCollection,"remove",this.displayCalories),this.listenTo(app.UserCollection,"filter",this.filterAll),this.listenTo(app.UserCollection,"all",this.render)},render:function(){var e=app.UserCollection.totalCalories();this.$counter.html(""),this.$counter.append(e)},filterAll:function(){app.UserCollection.each(this.filterOne,this)},filterOne:function(e){e.trigger("visible")},toggleClearLink:function(){app.UserCollection.length?this.$clearTracker.hasClass("hide")&&this.$clearTracker.removeClass("hide"):this.$clearTracker.addClass("hide")},addFoodItem:function(e){var t=new app.FoodItemView({model:e});this.$tracker.append(t.render().el)},clear:function(){_.each(_.clone(app.SearchCollection.models),function(e){e.destroy()})},addSearchItem:function(e){var t=new app.SearchItemView({model:e});this.$resultstxt.addClass("hide"),this.$results.append(t.render().el)},search:function(e){return this.getFoodItems(this.$input.val().trim()),this.$input.val(""),!1},populateSearchCollection:function(e){var t=this;this.clear();var i=e.hits;0===i.length&&t.$results.append("<div>No results found. Please try another search.</div>"),i.forEach(function(e){var t;t="Nutritionix"===e.fields.brand_name?"Not specified":e.fields.brand_name;var i=e.fields.item_name,s=e.fields.nf_calories;app.SearchCollection.add({brand:t,item:i,calories:s})})},getFoodItems:function(e){$(".modal-div").html(app.ProgressModal.render().el);var t=this,i="https://api.nutritionix.com/v1_1/search",s={appId:"04955d93",appKey:"749c36488818a1a355ece58154cef3ab",query:e,fields:["item_name","brand_name","nf_calories","item_type"],offset:0,limit:40};$.ajax({type:"POST",url:i,data:s}).done(function(e){app.ProgressModal.destroy(),t.populateSearchCollection(e)}).error(function(e){app.ProgressModal.destroy(),console.log("error: "+e.message),t.$results.append("<div>Search results could not be retrieved. Please try again later.</div>")})}});
var app=app||{},today=new Date,todayMinusSeven=new Date((new Date).setDate((new Date).getDate()-7)),todayDate=today.getDate(),todayMonth=today.getMonth(),todayYear=today.getFullYear();$(function(){new app.AppView});
var app=app||{},HealthTrackerRouter=Backbone.Router.extend({routes:{"":"defaultRoute",year:"showYear",day:"showToday",week:"showWeek",month:"showMonth"},setFilter:function(t){app.FoodItemFilter=t,app.UserCollection.trigger("filter")},deactivateTabs:function(){var t=[$("#total"),$("#day"),$("#week"),$("#month"),$("#year")];t.forEach(function(t){t.removeClass("active")})},defaultRoute:function(t){this.deactivateTabs(),$("#total").toggleClass("active"),this.setFilter("")},showYear:function(){this.deactivateTabs(),$("#year").toggleClass("active"),this.setFilter("year")},showToday:function(){this.deactivateTabs(),$("#day").toggleClass("active"),this.setFilter("day")},showWeek:function(){this.deactivateTabs(),$("#week").toggleClass("active"),this.setFilter("week")},showMonth:function(){this.deactivateTabs(),$("#month").toggleClass("active"),this.setFilter("month")}}),router=new HealthTrackerRouter;Backbone.history.start();